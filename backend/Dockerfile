# ============================================================================
# Base image
# ============================================================================
FROM node:18-alpine

# ============================================================================
# Install system dependencies FIRST (SSH client + git)
# ============================================================================
RUN apk add --no-cache openssh-client git

# ============================================================================
# Create app directory
# ============================================================================
WORKDIR /app

# ============================================================================
# Create keys directory for SSH keys
# ============================================================================
RUN mkdir -p /app/keys

# ============================================================================
# Copy package files
# ============================================================================
COPY package.json .

# ============================================================================
# Install dependencies
# ============================================================================
RUN npm install

# ============================================================================
# Copy application code
# ============================================================================
COPY . .

# ============================================================================
# Expose port
# ============================================================================
EXPOSE 5000

# ============================================================================
# Start application (ALWAYS LAST!)
# ============================================================================
CMD ["node", "server.js"]
